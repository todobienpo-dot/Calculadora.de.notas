<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Notas (2.0 - 7.0)</title>
    <style>
        :root {
            --color-fondo: #f4f7f6;
            --color-tarjeta: #ffffff;
            --color-primario: #005a9c;
            --color-texto: #333;
            --color-borde: #ddd;
            --color-aprobado: #28a745; /* Verde */
            --color-reprobado: #dc3545; /* Rojo */
            --color-perfecto: #ffc107; /* Dorado/Amarillo */
            --sombra: 0 4px 12px rgba(0,0,0,0.08);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                Helvetica, Arial, sans-serif;
            background-color: var(--color-fondo);
            color: var(--color-texto);
            display: grid;
            place-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .calculadora {
            background-color: var(--color-tarjeta);
            border-radius: 12px;
            box-shadow: var(--sombra);
            padding: 2.5rem;
            width: 100%;
            max-width: 450px;
        }
        h1 {
            text-align: center;
            color: var(--color-primario);
            margin-top: 0;
            margin-bottom: 2rem;
            font-size: 1.75rem;
        }
        .form-grupo {
            margin-bottom: 1.5rem;
        }
        .form-grupo label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .form-grupo input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--color-borde);
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
        }
        .form-grupo input:focus {
            outline: none;
            border-color: var(--color-primario);
            box-shadow: 0 0 0 3px rgba(0, 90, 156, 0.15);
        }
        button {
            width: 100%;
            padding: 1rem;
            background-color: var(--color-primario);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        button:hover {
            background-color: #004a80;
        }
        .resultado {
            margin-top: 2rem;
            text-align: center;
            padding: 1.5rem;
            border-radius: 8px;
            display: none;
        }
        .resultado .nota-valor {
            font-size: 3rem;
            font-weight: 800;
            line-height: 1;
        }
        .resultado .nota-mensaje {
            margin-top: 0.5rem;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* ESTILOS POR RANGO DE NOTA */
        .resultado.reprobado {
            color: var(--color-reprobado);
            background-color: #fdebee;
            display: block;
        }
        .resultado.aprobado {
            color: var(--color-aprobado);
            background-color: #eaf6ec;
            display: block;
        }
        .resultado.perfecto {
            color: var(--color-texto); /* Texto oscuro para contraste */
            background-color: var(--color-perfecto); /* Fondo Dorado/Amarillo */
            display: block;
        }
        .resultado.error {
            color: var(--color-reprobado);
            background-color: #fdebee;
            font-size: 1rem;
            font-weight: 600;
            display: block;
        }
    </style>
</head>
<body>

    <div class="calculadora">
        <h1>Calculadora de Notas</h1>
        <form id="form-calculo">
            
            <div class="form-grupo">
                <label for="p_obt">Puntaje Obtenido</label>
                <input type="number" id="p_obt" step="any" placeholder="Ej. 17.5" required>
            </div>

            <div class="form-grupo">
                <label for="p_max">Puntaje Máximo</label>
                <input type="number" id="p_max" step="any" placeholder="Ej. 25.0" required>
            </div>

            <div class="form-grupo">
                <label for="exig">Exigencia (%)</label>
                <input type="number" id="exig" value="60" min="1" max="100" step="1" required>
            </div>

            <button type="submit">Calcular Nota</button>
        </form>

        <div id="resultado" class="resultado">
            </div>
    </div>

    <script>
        document.getElementById('form-calculo').addEventListener('submit', function(event) {
            event.preventDefault(); 
            calcularNota();
        });

        function calcularNota() {
            // --- 1. Obtener Entradas ---
            const P_obt_val = document.getElementById('p_obt').value;
            const P_max_val = document.getElementById('p_max').value;
            const Exig_val = document.getElementById('exig').value;
            
            // El incremento de redondeo está fijo a 0.1 (a la décima)
            const Inc = 0.1; 
            
            const resultadoEl = document.getElementById('resultado');

            const P_obt = parseFloat(P_obt_val);
            const P_max = parseFloat(P_max_val);
            const Exig = parseFloat(Exig_val);

            // --- 2. Validación de Entradas ---
            if (isNaN(P_obt) || isNaN(P_max) || isNaN(Exig)) {
                mostrarResultado("Error: Todos los campos deben ser números.", 'error');
                return;
            }
            if (P_max <= 0) {
                mostrarResultado("Error: El puntaje máximo debe ser mayor a 0.", 'error');
                return;
            }
            if (Exig < 1 || Exig > 100) {
                mostrarResultado("Error: La exigencia debe estar entre 1% y 100%.", 'error');
                return;
            }

            // --- 3. Ajuste y Casos Ancla (Extremos) ---
            const P_obt_ajustado = Math.max(0, Math.min(P_obt, P_max));

            if (P_obt_ajustado === 0) {
                mostrarResultado(2.0);
                return;
            }
            if (P_obt_ajustado === P_max) {
                mostrarResultado(7.0);
                return;
            }

            // --- 4. Definir Punto de Aprobación ---
            const P_exig = P_max * (Exig / 100);

            // --- 5. Cálculo de Nota Bruta (Lineal por Tramos) ---
            let notaBruta;

            if (P_obt_ajustado < P_exig) {
                // TRAMO 1: Reprobación (Notas 2.0 a 4.0)
                if (P_exig === 0) { 
                    notaBruta = 4.0;
                } else {
                    const rangoNotaRep = 4.0 - 2.0; // = 2.0
                    notaBruta = 2.0 + (P_obt_ajustado / P_exig) * rangoNotaRep;
                }
            } else {
                // TRAMO 2: Aprobación (Notas 4.0 a 7.0)
                const rangoPuntajeApr = P_max - P_exig;
                const rangoNotaApr = 7.0 - 4.0; // = 3.0
                const puntajeEnTramo = P_obt_ajustado - P_exig;

                if (rangoPuntajeApr === 0) {
                    notaBruta = 7.0;
                } else {
                    notaBruta = 4.0 + (puntajeEnTramo / rangoPuntajeApr) * rangoNotaApr;
                }
            }

            // --- 6. Redondeo a la décima (0.1) ---
            let notaRedondeada = Math.round(notaBruta * 10) / 10;

            // --- 7. Validación Final (Post-Redondeo) ---
            if (notaRedondeada < 2.0) {
                notaRedondeada = 2.0;
            }
            if (notaRedondeada > 7.0) {
                notaRedondeada = 7.0;
            }
            
            // --- 8. Mostrar Resultado ---
            mostrarResultado(notaRedondeada);
        }

        function mostrarResultado(valor, tipo = 'nota') {
            const resultadoEl = document.getElementById('resultado');
            
            if (tipo === 'error') {
                resultadoEl.innerHTML = valor;
                resultadoEl.className = 'resultado error';
                return;
            }
            
            const nota = parseFloat(valor);
            let mensaje = "";
            let clase = "";

            // Lógica de mensajes y colores según la nota
            if (nota >= 2.0 && nota <= 3.0) {
                mensaje = "Estudia para la proxima!";
                clase = 'reprobado';
            } else if (nota >= 3.1 && nota <= 3.9) {
                mensaje = "Casi no es rojo, sigue intentando!";
                clase = 'reprobado';
            } else if (nota === 4.0) {
                mensaje = "Te salvaste del rojo, pero falta mucho por aprender!";
                clase = 'aprobado';
            } else if (nota >= 4.1 && nota <= 5.0) {
                mensaje = "Se que puedes mejorar!";
                clase = 'aprobado';
            } else if (nota >= 5.1 && nota <= 6.0) {
                mensaje = "Sigue asi, falta poco!";
                clase = 'aprobado';
            } else if (nota >= 6.1 && nota <= 6.5) {
                mensaje = "Casi, sigue aprendiando!";
                clase = 'aprobado';
            } else if (nota >= 6.6 && nota < 7.0) {
                mensaje = "Casi llegas al 7.0!";
                clase = 'aprobado';
            } else if (nota === 7.0) {
                mensaje = "Perfecto!";
                clase = 'perfecto';
            } else {
                mensaje = "Nota fuera de rango.";
                clase = 'error';
            }
            
            // Mostrar la nota y el mensaje en el HTML
            resultadoEl.innerHTML = `
                <div class="nota-valor">${nota.toFixed(1)}</div>
                <div class="nota-mensaje">${mensaje}</div>
            `;
            resultadoEl.className = `resultado ${clase}`;
        }
    </script>
</body>
</html>